name: Set Date

on:
  schedule:
    - cron: '* 0 * * *'

jobs:
  update-date:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Write Date File
      run: |
        echo -e -n "#ifndef VCS_DATE\n#define VCS_DATE $(date "+%Y%m%d")\n#endif" > ./firmware/date_stamp.h
        echo -e -n "#ifndef VCS_DATE\n#define VCS_DATE $(date "+%Y%m%d")\n#endif" > ./simulator/date_stamp.h
        echo -e -n "#ifndef VCS_DATE\n#define VCS_DATE $(date "+%Y%m%d")\n#endif" > ./unit_tests/date_stamp.h
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -m "Update date" -a 2>&1 | grep -E '(nothing to commit|changed)'

    - name: Push changed date file
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ github.token }}
        branch: master
